{
  email alex.barbalex@gmail.com
  #acme_ca https://acme-staging-v02.api.letsencrypt.org/directory
}

blue-borders.ch, www.blue-borders.ch {
  root * /html
  encode zstd gzip
  file_server
  
  reverse_proxy /bb/* {
    to bb_db:5984
    # unfortunately the transparent shorthand does not seem to exist (yet)
    # https://caddy.community/t/v2-reverse-proxy-transparent/6480/8
    #transparent
    header_up Host {http.request.host}
    header_up X-Real-IP {http.request.remote}
    header_up X-Forwarded-For {http.request.remote}
    header_up X-Forwarded-Port {http.request.port}
    header_up X-Forwarded-Proto {http.request.scheme}
  }
  
  reverse_proxy /_session {
    to bb_db:5984
    # unfortunately the transparent shorthand does not seem to exist (yet)
    # https://caddy.community/t/v2-reverse-proxy-transparent/6480/8
    #transparent
    header_up Host {http.request.host}
    header_up X-Real-IP {http.request.remote}
    header_up X-Forwarded-For {http.request.remote}
    header_up X-Forwarded-Port {http.request.port}
    header_up X-Forwarded-Proto {http.request.scheme}
  }
}

api.blue-borders.ch {
  reverse_proxy bb_db:5984 {
    # unfortunately the transparent shorthand does not seem to exist (yet)
    # https://caddy.community/t/v2-reverse-proxy-transparent/6480/8
    #transparent
    header_down "Access-Control-Allow-Origin *"
    header_down Access-Control-Allow-Credentials=true
    header_down "Access-Control-Allow-Methods: POST, GET, OPTIONS"
    header_up Host {http.request.host}
    header_up X-Real-IP {http.request.remote}
    header_up X-Forwarded-For {http.request.remote}
    header_up X-Forwarded-Port {http.request.port}
    header_up X-Forwarded-Proto {http.request.scheme}
  }
}

mediterranean-migration.com, www.mediterranean-migration.com {
  root * /html
  encode zstd gzip
  file_server
  
  reverse_proxy /bb/* {
    to bb_db:5984
    # unfortunately the transparent shorthand does not seem to exist (yet)
    # https://caddy.community/t/v2-reverse-proxy-transparent/6480/8
    #transparent
    header_up Host {http.request.host}
    header_up X-Real-IP {http.request.remote}
    header_up X-Forwarded-For {http.request.remote}
    header_up X-Forwarded-Port {http.request.port}
    header_up X-Forwarded-Proto {http.request.scheme}
  }
  
  reverse_proxy /_session {
    to bb_db:5984
    # unfortunately the transparent shorthand does not seem to exist (yet)
    # https://caddy.community/t/v2-reverse-proxy-transparent/6480/8
    #transparent
    header_up Host {http.request.host}
    header_up X-Real-IP {http.request.remote}
    header_up X-Forwarded-For {http.request.remote}
    header_up X-Forwarded-Port {http.request.port}
    header_up X-Forwarded-Proto {http.request.scheme}
  }
}

api.mediterranean-migration.com {
  reverse_proxy bb_db:5984 {
    # unfortunately the transparent shorthand does not seem to exist (yet)
    # https://caddy.community/t/v2-reverse-proxy-transparent/6480/8
    #transparent
    header_down "Access-Control-Allow-Origin *"
    header_down Access-Control-Allow-Credentials=true
    header_down "Access-Control-Allow-Methods: POST, GET, OPTIONS"
    header_up Host {http.request.host}
    header_up X-Real-IP {http.request.remote}
    header_up X-Forwarded-For {http.request.remote}
    header_up X-Forwarded-Port {http.request.port}
    header_up X-Forwarded-Proto {http.request.scheme}
  }
}
